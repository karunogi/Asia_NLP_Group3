# 또, 오셨네요. RE,COMMA
RE,COMMA는 사용자의 질문을 NLP를 통해 분석하여, 사용자 맞춤형 콘텐츠를 추천해주는 대화형 콘텐츠 추천 챗봇입니다.

추천을 뜻하는 Recommendation과 쉼표라는 의미의 Comma를 합쳐 휴식을 추천해준다는 의미를 담고있습니다.

## 작동 예시
![Honeycam 2020-09-19 22-57-42](https://user-images.githubusercontent.com/34763810/93669403-d6130880-face-11ea-9299-80a97e744e33.gif)
![Honeycam export 2020-09-19 23-11-30](https://user-images.githubusercontent.com/34763810/93669404-d6ab9f00-face-11ea-92a9-becf857692ff.jpg)
![Honeycam export 2020-09-19 23-11-41](https://user-images.githubusercontent.com/34763810/93669405-d7443580-face-11ea-8133-6503bacaf0c2.jpg)
![Honeycam export 2020-09-19 23-11-52](https://user-images.githubusercontent.com/34763810/93669464-4cb00600-facf-11ea-8fd5-c9dbc765b7eb.jpg)
![Honeycam export 2020-09-19 23-12-00](https://user-images.githubusercontent.com/34763810/93669475-8123c200-facf-11ea-8fde-be92797bfb8d.jpg)
![Honeycam export 2020-09-19 23-12-15](https://user-images.githubusercontent.com/34763810/93669398-d4e1db80-face-11ea-9888-cfe092a7912e.jpg)
![Honeycam export 2020-09-19 23-12-23](https://user-images.githubusercontent.com/34763810/93669400-d4e1db80-face-11ea-8d26-17879fa3a3da.jpg)
![Honeycam export 2020-09-19 23-12-46](https://user-images.githubusercontent.com/34763810/93669401-d57a7200-face-11ea-8354-bf46b87d7ac7.jpg)
![Honeycam export 2020-09-19 23-12-54](https://user-images.githubusercontent.com/34763810/93669402-d6130880-face-11ea-908e-37f94a0719f6.jpg)

## 실행 방법
- [HowToRun.txt](https://github.com/karunogi/Asia_NLP_Group3/blob/master/HowToRun.txt)
--------------
- 이 프로젝트는 아시아경제 청년취업아카데미: AI 딥러닝 기반 자연어처리 전문가 양성과정 수강생들의 작품입니다.
- 과정 수강중 강의해주신 [박형식](https://github.com/arkwith7/ArkChatBot) 아크위드(주) 대표님의 도움을 받아 제작되었습니다.

## 웹툰 추천 세부 설명
- 담당 : 주찬양 (한양대학교ERICA / 문화콘텐츠학과, 미디어테크놀로지학과)
- 연락 : karunogi@gmail.com

### 1. 기획 배경 : 
추천 서비스가 다양한 플랫폼에서 각 플랫폼만의 추천 서비스를 제공하고 있는데, 사용자들은 자신의 선호를 서비스에서 정한 알고리즘이 추천해주는 방법으로 받는 방법만이 존재한다. 사용자들은 자신의 선호하는 장르, 줄거리 등을 말하며 추천을 받을 때는 커뮤니티나 지식인에 글을 남기거나, 지인에게 물어보는 방식이 존재한다. 하지만 지식인 같은 온라인 게시판 서비스를 이용하면 실시간으로 답변이 오고가는 채팅에 비해 소통이 느리다는 단점이 있고, 주변 지인에게 물어보는 방법은 전자보다 상대적으로 빠르지만 데이터셋이 질문 받는 대상의 지식에 한정되어있다는 문제점이 있다. 그래서 여기에 챗봇 서비스를 이용하게 되면 빠른 소통과 수 많은 데이터셋으로 이 두가지 단점을 극복할 수 있다는 생각이 들어 기획하게 되었다.
![웹툰 질문](https://user-images.githubusercontent.com/45165814/93730516-f5f81880-fc03-11ea-9f80-e98217cf50a6.PNG)

#### 데이터 수집
우선 데이터셋을 네이버에 한정 지어서 수집했다.
BeautifulSoup과 Requests라이브러리를 사용하여 수집했고, 데이터 분석을 위해 제목, 작가, 장르, 서브장르, 카테고리, 별점, 줄거리, 컷툰인지여부(0[컷툰 아님],1[컷툰],3[플랫폼에서 컷툰 서비스 제공하지 않음]으로 표현), 플랫폼을 수집했고, 서비스 구현에 필요한 상세페이지url과 썸네일 이미지url로 나누어서 수집했다.

데이터 예시)
```
{'영수의 봄': {
  'title': '영수의 봄', 
  'category': '스토리', 
  'gerne': '드라마', 
  'sub_gerne': '드라마', 
  'author': '이윤희', 
  'star': '9.96', 
  'cuttoon': 0, 
  'summary': '카메라를 들고 셋을 세었을 때 나는 사랑의 마법에 걸렸다?!SBA-서울문화사-네이버가 함께하는 2014 만화 스카우트 당선작입니다.', 
  'detail_url': 'https://comic.naver.com/webtoon/list.nhn?titleId=639080', 
  'img_url': 'https://shared-comic.pstatic.net/thumb/webtoon/639080/thumbnail/title_thumbnail_20141022222807_t83x90.jpg', 
  'platform': 'naver'
  },...
```
### 1차 모델 완성 과정

#### 첫번째 계획 - 사용자마다 선호 모델을 만들기
- 데이터 분석 영역으로 들어가서 사용자가 웹툰을 선정하는데 고려할 수 있는 요소를 나누어 작품별로 해당 요소에 값을 부여한다. 이때 사용자가 좋아했던 작품과 좋아하지 않았던 작품을 나누어 1부터5까지 라벨링을 실시하고, 해당 데이터셋을 기반으로 딥러닝을 통해 새로운 웹툰 데이터가 들어오면 해당 작품을 사용자가 얼마나 좋아할 지 예측한 후 알려준다.
- 또한 초반에 데이터가 부족한 문제를 해결하기 위해, 사용자가 좋아하는 콘텐츠를 10개 정도 선택해주면 그와 유사한 사용자를 찾아서 그 사용자의 선호 모델에 추가 학습을 시킨다.

우선 실현가능성을 알아보기 위해 모델을 구성하고 사용자의 선호는 임시로 1,0(선호, 불호)으로 나누어 진행. 장르와 작가의 이름은 Bag of word를 사용하여 숫자화 하고, 별점만을 사용해 돌려보았다.
```
Model: "sequential"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
dense (Dense)                (None, 10000)             40000     
_________________________________________________________________
dropout (Dropout)            (None, 10000)             0         
_________________________________________________________________
dense_1 (Dense)              (None, 128)               1280128   
_________________________________________________________________
dropout_1 (Dropout)          (None, 128)               0         
_________________________________________________________________
dense_2 (Dense)              (None, 64)                8256      
_________________________________________________________________
dense_3 (Dense)              (None, 64)                4160      
_________________________________________________________________
dense_4 (Dense)              (None, 5)                 325       
=================================================================
Total params: 1,332,869
Trainable params: 1,332,869
Non-trainable params: 0
_________________________________________________________________
ACC_0.2704 Val_Acc_0.2400 (Best result)
```
구현 과정중에 들어난 문제점은 두가지였다.</br>
<b>첫번째 아무래도 서로 관련이 없는 라벨링 데이터다 보니 학습을 돌려도 정확도가 잘 나오지 않는다.</b></br>
 -> 해당 문제는 데이터셋의 피쳐(줄거리, 장르, 작가 등)을 더 추가한 후, 유사한 사례인 타이타닉 생존자 데이터 학습 사례를 참고하면 해결할 수 있는 문제</br>
<b>두번째 사용자의 선호를 파악하기 어려운 문제가 있었다.</b></br>
 -> 처음부터 사용자의 선호를 물어봐서 조사하는 방법이 있지만 너무 오래걸린다.</br>
 -> 유사한 사용자를 찾아야 하지만 초기에 다른 사용자들이 참고할만한 데이터를 가진 사용자를 찾기 힘들다.(거의 불가능 하다)</br>
 
 #### 계획 수정 - 초반 사용자들의 선호를 체크할 수 있고, 원래 의도에 맞게 대화형으로 사용자의 선호를 알 수 있는 챗봇
수집한 데이터의 X features중에 사용자가 웹툰을 고를 때 기준으로 삼는 데이터는 크게 장르와 줄거리이고, 세부적으로는 평점, 작가, 플랫폼이 있다.
하지만 대화를 통해 이 모든 요소를 파악 하기에는 사용자는 답답하다.
```
answer1 = imput("선호하는 장르가 있나요?")
answer2 = imput("선호하는 줄거리가 있나요?")
answer3 = imput("평점은 어느정도면 좋나요?")
...
```
그래서 우선적으로 장르와 줄거리를 통해 웹툰을 추천해주고, 나머지 요소(평점, 작가 등)에 대한 선호는 그 개인에 대한 선호 데이터를 쌓아서 첫번째 시도에서 했던 사용자별 선호 모델을 학습하는 방법을 채택하기로 했다.

#### 제작 진행 내용
<b>단계 : (1)사용자가 원하는 장르 파악 -> (2)사용자가 원하는 줄거리 파악</b>
##### (1)사용자가 원하는 장르 파악
우선 간단한 분류 모델을 통해 네이버 웹툰의 10가지 장르를 구별하는 기능을 구현했다.

학습에 사용한 JSON형식의 데이터셋(감성, 개그, 드라마, 순정, 스릴러, 스포츠, 시대극, 액션, 일상, 판타지의 장르별 문장 데이터)
```
{"gerne": [
        {"tag": "감성",
         "patterns": ["감성적인 웹툰 추천해줘","감동적인거","따듯한거","감수성","감성","눈물 흘릴 만한 거","감정적인거","마음 따듯해지는거","품부한 감성","감성 자극","감성 인식","울고 싶을 때 볼만한 것","감동적인 기분","행복한 기분","슬픈 내용 웹툰","슬픈거"],
         "responses": ["감성적인 웹툰중에 추천해드릴게요"],
         "context_set": ""
        },
        {"tag": "개그",
         "patterns": ["웃고 싶은 웹툰","재밌는 웹툰","재밌는거 추천해줘","웃고 싶을 때 보는 웹툰 추천해줘","우울할 때 즐거워지는 웹툰 추천해줘","개그","개그 웹툰 추천해줘","웃긴 웹툰 추천해줘","많이 웃긴거","재밌는 웹툰","우스꽝스러운거","익살스러운것","웃을 수 있는 웹툰","웃다","깔깔거리며 웃을 수 있는 웹툰 추천해줘","너무 재밌는 웹툰 추천해줘","웃긴 웹툰","웃긴 내용","재밌는"],
         "responses": ["개그 웹툰중에 추천해드릴게요"]
        },...
}
```
학습한 모델
```
Model: "sequential"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
dense (Dense)                (None, None, 8)           1656      
_________________________________________________________________
dense_1 (Dense)              (None, None, 8)           72        
_________________________________________________________________
dense_2 (Dense)              (None, None, 10)          90        
=================================================================
Total params: 1,818
Trainable params: 1,818
Non-trainable params: 0
_________________________________________________________________
2/2 [==============================] - 0s 2ms/step - loss: 2.3031 - accuracy: 0.1130
Epoch 2/1000
...
Epoch 100/1000
2/2 [==============================] - 0s 2ms/step - loss: 1.4694 - accuracy: 0.5819
...
Epoch 250/1000
2/2 [==============================] - 0s 2ms/step - loss: 0.2768 - accuracy: 0.9831
...
Epoch 1000/1000
2/2 [==============================] - 0s 2ms/step - loss: 0.0030 - accuracy: 1.0000
```
과적합이 일어났지만, 실제 사용했을 때 각 장르별 핵심키워드(예 - 장르 : 감성, 핵심 키워드 : 감성, 감수성, 눈물)가 정확히 인식되려면 loss값이 줄어들어야 했다.</br>
그래서 1000epchs을 돌려서 일정이상 loss값을 줄였다.

실행 예시
```
어떤 장르의 웹툰을 추천해 드릴까요? 역동적인 액션추천해줘
['역', '동', '적', '인', '액션', '해주다']
액션 를 추천해드릴게요
```
##### (2)사용자가 원하는 줄거리 파악
사용자가 선호하는 즐거리 파악은 데이터셋에서 줄거리 데이터를 가져와 사용자가 원하는 데이터와 가장 유사한 데이터를 추천해주는 방법을 사용하기 위해 코사인 유사도 함수를 사용하였다.
```
def add_user_sentence(user_text,answer)
def cosine_similarity(data)
def get_recommendations(data, indices, cosine_sim, title="UserData")
```
코사인 유사도 함수는 [WIKIDOCS](https://wikidocs.net/24603 "자연어처리 위키독스문서")에서 참고했다. </br>
add_user_sentence함수는 유저가 원하는 줄거리와 장르를 인자로 받아 웹툰 데이터 셋에서 해당 장르만 추출한 데이터 셋에 유저의 줄거리 정보를 추가한 데이터 셋을 반환한다.</br>
cosine_similarity함수는 데이터 셋을 넣으면 데이터 셋의 tf-idf값을 계산하고 이를 활용하여 코사인 유사도를 사전을 반환하고, 추가적으로 데이터 셋의 인덱스 사전을 반환한다.</br>
get_recommendations함수는 사용자의 선호로 걸러진 데이터셋과 인덱스 사전, 코사인 유사도 사전을 넣으면 사용자가 원한 내용의 줄거리를 반환해준다.

##### 1차 완성 시험

```
어떤 장르의 웹툰을 추천해 드릴까요?역동적인 액션추천해줘
['역', '동', '적', '인', '액션', '해주다']
액션 를 추천해드릴게요

어떤 스토리의 웹툰을 추천해 드릴까요?러브라인있고 사랑 이야기 있는거
178개의 데이터셋과 1623개의 단어 구성
32            플레이어
127             총수
83              지원
53         돌아온 럭키짱
135           통 1부
77               킥
5      마루한 - 구현동화전
137            오랑캐
130         독고 플라워
138         헤븐즈 소울
```
##### 보완할 점
- <b>데이터 셋이 부족한 문제</b> : 데이터 셋이 약 1100개이다 보니 유사도를 기반으로 추천을 해도 정확한 내용이 나오지 않는 경우가 많음.</br>
  -> 추가적인 데이터 수집을 통해 보완(다음, ktoon, 레진코믹스 등의 플랫폼 활용)</br>
- <b>추천 질문이 단순한 문제</b> : 사용자에게 얻는 정보가 장르, 줄거리 밖에 없다보니 다양한 사용자의 취향을 반영하기 어려움.</br>
  -> 유저 데이터를 더 모아서 장르, 줄거리 외의 별점, 플랫폼, 작가등의 피쳐를 활용하여 유저별로 취향 모델을 만들고, 추가적으로 이미지 데이터를 활용하여 그림체까지 하나의 카테고리로 두어 반영</br>
- <b>챗봇 기능의 부족</b> : 챗봇 서비스이지만 사용자와 소통을 하는 기능이 적어 챗봇이라기 보다는 취향조사에 가까움. 좀 더 유연하게 대처할 수 있어야함.</br>
  -> 챗봇이 좀 더 유연하게 대처할 수 있게 다른 대화모델 논문들을 참고하고, 아무 대화나 하는 것이 아니라 적어도 콘텐츠 관련 대화를 하며 사용자의 취향 파악에 사용할 데이터로 활용
